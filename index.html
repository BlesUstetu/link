<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Link Shortener</title>
<style>
  body{font-family:Arial,sans-serif;margin:20px}
  input,button{padding:10px;font-size:16px}
  button{cursor:pointer}
  #log{margin-top:12px;padding:10px;border:1px solid #ddd;border-radius:8px;background:#fafafa;white-space:pre-wrap}
  .ok{color:green} .err{color:#b00020}
</style>
</head>
<body>

<h2>Link Shortener (Debug)</h2>

<input id="longUrl" type="text" placeholder="Masukkan link panjang" style="width:100%;max-width:720px" />
<br><br>

<button onclick="shortenUrl()">Pendekkan</button>
<button onclick="copyShort()" id="copyBtn" disabled>Copy</button>
<button onclick="openShort()" id="openBtn" disabled>Open</button>

<p id="result">Hasil akan muncul di sini.</p>

<div id="log">LOG: (kalau tombol diklik tapi tidak jalan, di sini akan terlihat penyebabnya)</div>

<script>
  const logEl = document.getElementById("log");
  const resultEl = document.getElementById("result");
  const copyBtn = document.getElementById("copyBtn");
  const openBtn = document.getElementById("openBtn");
  let lastShortUrl = "";

  function log(msg, type=""){
    const cls = type === "err" ? "err" : (type === "ok" ? "ok" : "");
    logEl.innerHTML = `LOG: <span class="${cls}">${msg}</span>`;
  }

  function normalizeUrl(input){
    let url = (input || "").trim();
    if (!url) return "";
    if (!/^https?:\/\//i.test(url)) url = "https://" + url;
    return url;
  }

  function isValidUrl(url){
    try { new URL(url); return true; } catch { return false; }
  }

  async function shortenUrl(){
    try{
      log("Klik terdeteksi. Memproses...", "");
      lastShortUrl = "";
      copyBtn.disabled = true;
      openBtn.disabled = true;

      const longUrl = normalizeUrl(document.getElementById("longUrl").value);
      if (!longUrl) {
        resultEl.textContent = "Masukkan link dulu.";
        return log("Input kosong.", "err");
      }
      if (!isValidUrl(longUrl)) {
        resultEl.textContent = "Format URL tidak valid.";
        return log("URL tidak valid.", "err");
      }

      resultEl.textContent = "Memproses (fetch TinyURL)...";
      const api = `https://tinyurl.com/api-create.php?url=${encodeURIComponent(longUrl)}`;
      log("Fetch ke: " + api);

      const res = await fetch(api);
      const shortUrl = (await res.text()).trim();

      if (shortUrl.startsWith("http")){
        lastShortUrl = shortUrl;
        resultEl.innerHTML = `Link pendek: <a href="${shortUrl}" target="_blank" rel="noopener">${shortUrl}</a>`;
        copyBtn.disabled = false;
        openBtn.disabled = false;
        log("Berhasil: " + shortUrl, "ok");
      } else {
        resultEl.textContent = "Gagal mempersingkat link.";
        log("Respon tidak valid: " + shortUrl, "err");
      }
    } catch (e){
      resultEl.textContent = "Terjadi error. Lihat LOG.";
      log("ERROR: " + (e && e.message ? e.message : String(e)), "err");
    }
  }

  async function copyShort(){
    try{
      if (!lastShortUrl) return log("Belum ada link pendek untuk dicopy.", "err");
      // clipboard butuh HTTPS
      await navigator.clipboard.writeText(lastShortUrl);
      log("Copied to clipboard.", "ok");
    } catch (e){
      log("Copy gagal (biasanya karena bukan HTTPS): " + (e.message || e), "err");
    }
  }

  function openShort(){
    if (!lastShortUrl) return log("Belum ada link pendek untuk dibuka.", "err");
    window.open(lastShortUrl, "_blank", "noopener");
    log("Open: " + lastShortUrl, "ok");
  }

  // bukti script jalan
  log("Script loaded âœ…. Jika tombol masih tidak respon, kemungkinan platform memblokir JS atau file dibuka via file://", "ok");
</script>

</body>
</html>
